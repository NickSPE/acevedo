{% extends 'core/auth_base.html' %}

{% block title %}Iniciar Sesi칩n - FinGest{% endblock %}

{% block nav_links %}
    <a href="{% url 'usuarios:register_simple' %}" class="bg-emerald-600 text-white px-4 py-2 rounded-lg hover:bg-emerald-700 transition-colors">
        Crear Cuenta
    </a>
{% endblock %}

{% block content %}
<div class="w-full max-w-md mx-auto p-4">
    <div class="bg-white rounded-2xl shadow-2xl p-8 relative">
        <!-- Bot칩n X para cerrar -->
        <button 
            id="closeButton"
            class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-all duration-200 z-10 p-1 rounded-full hover:bg-gray-100"
            title="Volver a la p치gina principal"
            type="button"
        >
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
        
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Bienvenido de Vuelta</h1>
            <p class="text-gray-600">Inicia sesi칩n en tu cuenta de FinGest</p>
        </div>

        {% if message_success %}
            <div class="mb-6 text-emerald-600 text-center font-semibold bg-emerald-100 rounded-lg p-3 border border-emerald-200">
                {{ message_success }}
            </div>
        {% endif %}
        
        {% if message_error %}
            <div class="mb-6 text-red-600 text-center font-semibold bg-red-100 rounded-lg p-3 border border-red-200">
                {{ message_error }}
            </div>
        {% endif %}

        <form class="space-y-6" method="post" action="{% url 'usuarios:login' %}">
            {% csrf_token %}
            
            <div>
                <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                    Correo electr칩nico
                </label>
                <input 
                    type="email" 
                    id="email" 
                    name="email" 
                    placeholder="ejemplo@email.com"
                    class="w-full p-3 border {% if errors.email_error %}border-red-500{% else %}border-gray-300{% endif %} rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition" 
                    required 
                    value="{{ email|default:'' }}"
                />
                {% if errors.email_error %}
                    <p class="text-xs text-red-500 mt-1">{{ errors.email_error }}</p>
                {% endif %}
            </div>

            <div>
                <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
                    Contrase침a
                </label>
                <div class="relative">
                    <input 
                        type="password" 
                        id="password" 
                        name="password"
                        placeholder="Tu contrase침a"
                        class="w-full p-3 border {% if errors.password_error %}border-red-500{% else %}border-gray-300{% endif %} rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition pr-12" 
                        required 
                    />
                    <button type="button" id="togglePassword" class="absolute inset-y-0 right-0 pr-3 flex items-center">
                        <svg id="eye-closed" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M3.28 2.22a.75.75 0 00-1.06 1.06l14.5 14.5a.75.75 0 001.06-1.06l-1.745-1.745a10.029 10.029 0 003.3-4.38 1.651 1.651 0 000-1.185A10.004 10.004 0 009.999 3a9.956 9.956 0 00-4.744 1.194L3.28 2.22zM7.752 6.69l1.092 1.092a2.5 2.5 0 013.374 3.373l1.091 1.092a4 4 0 00-5.557-5.557z" />
                            <path d="M10.748 13.93l2.523 2.523a9.987 9.987 0 01-3.27.547c-4.258 0-7.894-2.66-9.337-6.41a1.651 1.651 0 010-1.186A10.007 10.007 0 012.839 6.02L6.07 9.252a4 4 0 004.678 4.678z" />
                        </svg>
                        <svg id="eye-open" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 hidden" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                            <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                    </button>
                </div>
                {% if errors.password_error %}
                    <p class="text-xs text-red-500 mt-1">{{ errors.password_error }}</p>
                {% endif %}
            </div>

            <button 
                type="submit"
                class="w-full bg-gradient-to-r from-emerald-600 to-teal-600 text-white font-bold py-3 rounded-lg shadow-lg hover:from-emerald-700 hover:to-teal-700 hover:shadow-xl transform hover:scale-105 transition-all duration-200"
            >
                Iniciar Sesi칩n
            </button>
        </form>

        <!-- Enlaces adicionales -->
        <div class="mt-6 space-y-4">
            <!-- Acceso con PIN -->
            <div class="text-center">
                <a href="{% url 'usuarios:pin_login' %}" class="inline-flex items-center gap-2 text-sm text-emerald-600 hover:text-emerald-800 font-medium">
                    游댝 Acceso r치pido con PIN
                </a>
                <p class="text-xs text-gray-500 mt-1">Accede directamente con tu PIN personal</p>
            </div>

            <!-- Registro -->
            <div class="text-center text-sm text-gray-600">
                쯅o tienes una cuenta? 
                <a href="{% url 'usuarios:register_simple' %}" class="text-emerald-600 hover:text-emerald-800 font-medium">
                    Reg칤strate aqu칤
                </a>
            </div>

            <!-- Recuperar contrase침a -->
            <div class="text-center">
                <a href="{% url 'usuarios:password_reset_request' %}" class="text-sm text-gray-500 hover:text-gray-700">
                    쯆lvidaste tu contrase침a?
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Script para mostrar/ocultar contrase침a
document.addEventListener('DOMContentLoaded', function() {
    const togglePassword = document.getElementById('togglePassword');
    const password = document.getElementById('password');
    const eyeClosed = document.getElementById('eye-closed');
    const eyeOpen = document.getElementById('eye-open');
    
    if (togglePassword && password && eyeClosed && eyeOpen) {
        togglePassword.addEventListener('click', function() {
            // Cambiar el tipo de input entre password y text
            const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
            password.setAttribute('type', type);
            
            // Cambiar el icono
            eyeClosed.classList.toggle('hidden');
            eyeOpen.classList.toggle('hidden');
        });
    }
    
    // Funcionalidad para el bot칩n de cerrar (X)
    const closeButton = document.getElementById('closeButton');
    if (closeButton) {
        closeButton.addEventListener('click', function() {
            // A침adir una peque침a animaci칩n antes de redirigir
            this.style.transform = 'rotate(90deg)';
            setTimeout(() => {
                window.location.href = '{% url "core:index" %}';
            }, 150);
        });
    }
});
</script>
{% endblock %}
