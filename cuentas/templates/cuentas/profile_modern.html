{% extends "core/base_template.html" %}
{% block title %}Mi Perfil - FinGest{% endblock %}

{% block content %}
<div class="modern-profile-container">
    <!-- Header superior minimalista -->
    <div class="profile-hero">
        <div class="hero-background">
            <div class="hero-gradient"></div>
            <div class="hero-pattern"></div>
        </div>
        <div class="hero-content">
            <div class="profile-badge">
                {% if imagen_base64 and formato_imagen %}
                    <img src="data:image/{{ formato_imagen|lower }};base64,{{ imagen_base64 }}" 
                         alt="Foto de perfil" class="badge-avatar">
                {% else %}
                    <div class="badge-avatar-placeholder">
                        {{ usuario.nombres.0|upper }}{{ usuario.apellido_paterno.0|upper }}
                    </div>
                {% endif %}
                <div class="badge-status"></div>
            </div>
            <div class="profile-intro">
                <h1 class="profile-name">{{ usuario.nombres }} {{ usuario.apellido_paterno }}</h1>
                <p class="profile-email">{{ usuario.correo }}</p>
                <div class="profile-meta">
                    {% if usuario.telefono %}
                        <span class="meta-pill">
                            <i class="fas fa-phone"></i>
                            {{ usuario.telefono }}
                        </span>
                    {% endif %}
                    {% if usuario.pais %}
                        <span class="meta-pill">
                            <i class="fas fa-globe"></i>
                            {{ usuario.pais }}
                        </span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Contenido principal -->
    <div class="profile-main">
        <!-- Navegación de tabs minimalista -->
        <div class="tab-navigation">
            <div class="nav-track">
                <div class="nav-indicator"></div>
            </div>
            <button class="nav-tab {% if tab == 'general' or not tab %}active{% endif %}" 
                    data-tab="general" onclick="switchTab('general')">
                <i class="fas fa-user"></i>
                <span>General</span>
            </button>
            <button class="nav-tab {% if tab == 'security' %}active{% endif %}" 
                    data-tab="security" onclick="switchTab('security')">
                <i class="fas fa-shield-alt"></i>
                <span>Seguridad</span>
            </button>
            <button class="nav-tab" data-tab="preferences" onclick="switchTab('preferences')">
                <i class="fas fa-cog"></i>
                <span>Preferencias</span>
            </button>
        </div>

        <!-- Contenido de tabs -->
        <div class="tab-content-container">
            
            <!-- Tab General -->
            <div class="tab-content {% if tab == 'general' or not tab %}active{% endif %}" id="tab-general">
                <div class="content-grid">
                    
                    <!-- Información personal -->
                    <div class="info-card">
                        <div class="card-header">
                            <div class="header-icon">
                                <i class="fas fa-user-circle"></i>
                            </div>
                            <div class="header-text">
                                <h3>Información Personal</h3>
                                <p>Gestiona tus datos básicos</p>
                            </div>
                            <button class="edit-toggle" onclick="toggleEdit('personal')">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                        
                        <form method="post" class="card-form" id="personal-form">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="update_profile">
                            
                            <div class="form-layout">
                                <div class="input-group">
                                    <label>Nombres</label>
                                    <input type="text" name="nombres" value="{{ usuario.nombres }}" readonly>
                                </div>
                                
                                <div class="input-group">
                                    <label>Apellido Paterno</label>
                                    <input type="text" name="apellido_paterno" value="{{ usuario.apellido_paterno }}" readonly>
                                </div>
                                
                                <div class="input-group">
                                    <label>Apellido Materno</label>
                                    <input type="text" name="apellido_materno" value="{{ usuario.apellido_materno|default:'' }}" readonly>
                                </div>
                                
                                <div class="input-group">
                                    <label>País</label>
                                    <select name="pais" disabled>
                                        <option value="">Selecciona tu país</option>
                                        <option value="Peru" {% if usuario.pais == "Peru" %}selected{% endif %}>Perú</option>
                                        <option value="Spain" {% if usuario.pais == "Spain" %}selected{% endif %}>España</option>
                                        <option value="United States" {% if usuario.pais == "United States" %}selected{% endif %}>Estados Unidos</option>
                                        <option value="Mexico" {% if usuario.pais == "Mexico" %}selected{% endif %}>México</option>
                                        <option value="Argentina" {% if usuario.pais == "Argentina" %}selected{% endif %}>Argentina</option>
                                        <option value="Colombia" {% if usuario.pais == "Colombia" %}selected{% endif %}>Colombia</option>
                                        <option value="Chile" {% if usuario.pais == "Chile" %}selected{% endif %}>Chile</option>
                                        <option value="Otro" {% if usuario.pais == "Otro" %}selected{% endif %}>Otro</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-actions hidden" id="personal-actions">
                                <button type="button" onclick="cancelEdit('personal')" class="btn-cancel">
                                    Cancelar
                                </button>
                                <button type="submit" class="btn-save">
                                    <i class="fas fa-check"></i>
                                    Guardar
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Información de contacto -->
                    <div class="info-card">
                        <div class="card-header">
                            <div class="header-icon">
                                <i class="fas fa-address-book"></i>
                            </div>
                            <div class="header-text">
                                <h3>Contacto</h3>
                                <p>Información de contacto</p>
                            </div>
                            <button class="edit-toggle" onclick="toggleEdit('contact')">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                        
                        <form method="post" class="card-form" id="contact-form">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="update_contact">
                            
                            <div class="form-layout">
                                <div class="input-group full-width">
                                    <label>Correo Electrónico</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-envelope"></i>
                                        <input type="email" name="email" value="{{ usuario.correo }}" readonly>
                                    </div>
                                </div>
                                
                                <div class="input-group full-width">
                                    <label>Teléfono</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-phone"></i>
                                        <input type="tel" name="telefono" value="{{ usuario.telefono|default:'' }}" 
                                               placeholder="+51 999 999 999" readonly>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-actions hidden" id="contact-actions">
                                <button type="button" onclick="cancelEdit('contact')" class="btn-cancel">
                                    Cancelar
                                </button>
                                <button type="submit" class="btn-save">
                                    <i class="fas fa-check"></i>
                                    Guardar
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Foto de perfil -->
                    <div class="info-card photo-card">
                        <div class="card-header">
                            <div class="header-icon">
                                <i class="fas fa-camera"></i>
                            </div>
                            <div class="header-text">
                                <h3>Foto de Perfil</h3>
                                <p>Personaliza tu avatar</p>
                            </div>
                        </div>
                        
                        <div class="photo-section">
                            <div class="photo-preview">
                                {% if imagen_base64 and formato_imagen %}
                                    <img src="data:image/{{ formato_imagen|lower }};base64,{{ imagen_base64 }}" 
                                         alt="Foto de perfil" class="preview-image">
                                {% else %}
                                    <div class="preview-placeholder">
                                        {{ usuario.nombres.0|upper }}{{ usuario.apellido_paterno.0|upper }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <form method="post" enctype="multipart/form-data" class="photo-upload">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="change_photo">
                                <input type="file" name="imagen_perfil" id="imagen_perfil" accept="image/*" 
                                       onchange="this.form.submit()">
                                <label for="imagen_perfil" class="btn-upload">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    Subir Foto
                                </label>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Seguridad -->
            <div class="tab-content {% if tab == 'security' %}active{% endif %}" id="tab-security">
                <div class="content-grid">
                    
                    <!-- Cambiar contraseña -->
                    <div class="info-card security-card">
                        <div class="card-header">
                            <div class="header-icon">
                                <i class="fas fa-lock"></i>
                            </div>
                            <div class="header-text">
                                <h3>Contraseña</h3>
                                <p>Actualiza tu contraseña de acceso</p>
                            </div>
                        </div>
                        
                        <form method="post" class="card-form" id="password-form">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="change_password">
                            
                            <div class="form-layout">
                                <div class="input-group full-width">
                                    <label>Contraseña Actual</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-key"></i>
                                        <input type="password" name="actual_password" id="current-pass">
                                        <button type="button" class="toggle-password" onclick="togglePassword('current-pass')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="input-group">
                                    <label>Nueva Contraseña</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-lock"></i>
                                        <input type="password" name="new_password" id="new-pass">
                                        <button type="button" class="toggle-password" onclick="togglePassword('new-pass')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="input-group">
                                    <label>Confirmar Contraseña</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-check-circle"></i>
                                        <input type="password" name="confirm_password" id="confirm-pass">
                                        <button type="button" class="toggle-password" onclick="togglePassword('confirm-pass')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="security-indicators">
                                <div class="indicator" id="length-indicator">
                                    <i class="fas fa-times"></i>
                                    <span>Mínimo 8 caracteres</span>
                                </div>
                                <div class="indicator" id="match-indicator">
                                    <i class="fas fa-times"></i>
                                    <span>Las contraseñas coinciden</span>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn-save" id="change-password-btn" disabled>
                                    <i class="fas fa-shield-alt"></i>
                                    Actualizar Contraseña
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Cambiar PIN -->
                    <div class="info-card security-card">
                        <div class="card-header">
                            <div class="header-icon">
                                <i class="fas fa-fingerprint"></i>
                            </div>
                            <div class="header-text">
                                <h3>PIN de Seguridad</h3>
                                <p>PIN para operaciones sensibles</p>
                            </div>
                        </div>
                        
                        <form method="post" class="card-form" id="pin-form">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="change_pin">
                            
                            <div class="form-layout">
                                <div class="input-group">
                                    <label>PIN Actual</label>
                                    <input type="password" name="actual_pin" maxlength="6" class="pin-input">
                                </div>
                                
                                <div class="input-group">
                                    <label>Nuevo PIN</label>
                                    <input type="password" name="new_pin" maxlength="6" class="pin-input">
                                </div>
                                
                                <div class="input-group">
                                    <label>Confirmar PIN</label>
                                    <input type="password" name="confirm_pin" maxlength="6" class="pin-input">
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn-save">
                                    <i class="fas fa-fingerprint"></i>
                                    Actualizar PIN
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Tab Preferencias -->
            <div class="tab-content" id="tab-preferences">
                <div class="content-grid">
                    <div class="info-card">
                        <div class="card-header">
                            <div class="header-icon">
                                <i class="fas fa-palette"></i>
                            </div>
                            <div class="header-text">
                                <h3>Apariencia</h3>
                                <p>Personaliza la interfaz</p>
                            </div>
                        </div>
                        
                        <div class="preferences-content">
                            <div class="preference-item">
                                <div class="preference-info">
                                    <h4>Tema Oscuro</h4>
                                    <p>Activa el modo oscuro para reducir el cansancio visual</p>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="dark-mode">
                                    <label for="dark-mode"></label>
                                </div>
                            </div>
                            
                            <div class="preference-item">
                                <div class="preference-info">
                                    <h4>Notificaciones</h4>
                                    <p>Recibe alertas sobre movimientos y actividades</p>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="notifications" checked>
                                    <label for="notifications"></label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Variables modernas */
:root {
    --primary: #84f6d9;
    --primary-dark: #7adcf7;
    --primary-light: #154552;
    --secondary: #f1f5f9;
    --accent: #ec4899;
    --success: #10b981;
    --warning: #f59e0b;
    --error: #ef4444;
    --text-primary: #0f172a;
    --text-secondary: #475569;
    --text-muted: #64748b;
    --border: #e2e8f0;
    --border-light: #f1f5f9;
    --glass: rgba(255, 255, 255, 0.25);
    --glass-border: rgba(255, 255, 255, 0.18);
    --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --radius-xs: 4px;
    --radius-sm: 6px;
    --radius-md: 8px;
    --radius-lg: 12px;
    --radius-xl: 16px;
    --radius-2xl: 20px;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-fast: all 0.15s ease;
}

/* Reset moderno */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

.modern-profile-container {
    min-height: 100vh;
    background: linear-gradient(135deg, #ffffff 0%, #ffffff 100%);
    padding: 1rem;
}

/* Hero section */
.profile-hero {
    position: relative;
    margin-bottom: 2rem;
    border-radius: var(--radius-2xl);
    overflow: hidden;
    background: white;
    box-shadow: var(--shadow-lg);
}

.hero-background {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 120px;
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
}

.hero-gradient {
    position: absolute;
    inset: 0;
    background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 100%);
}

.hero-pattern {
    position: absolute;
    inset: 0;
    background-image: radial-gradient(circle at 25% 25%, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
    background-size: 20px 20px;
}

.hero-content {
    position: relative;
    display: flex;
    align-items: center;
    gap: 1.5rem;
    padding: 2rem;
    padding-top: 3rem;
}

.profile-badge {
    position: relative;
    flex-shrink: 0;
}

.badge-avatar, .badge-avatar-placeholder {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    border: 4px solid white;
    box-shadow: var(--shadow-md);
}

.badge-avatar-placeholder {
    background: var(--primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    font-weight: 600;
}

.badge-status {
    position: absolute;
    bottom: 4px;
    right: 4px;
    width: 16px;
    height: 16px;
    background: var(--success);
    border: 3px solid white;
    border-radius: 50%;
}

.profile-intro {
    flex: 1;
    min-width: 0;
}

.profile-name {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.25rem;
}

.profile-email {
    color: var(--text-secondary);
    margin-bottom: 0.75rem;
    font-size: 0.95rem;
}

.profile-meta {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
}

.meta-pill {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.375rem 0.75rem;
    background: var(--secondary);
    border-radius: var(--radius-md);
    font-size: 0.8rem;
    color: var(--text-secondary);
}

.meta-pill i {
    font-size: 0.75rem;
    color: var(--primary);
}

/* Contenido principal */
.profile-main {
    max-width: 1000px;
    margin: 0 auto;
}

/* Navegación de tabs moderna */
.tab-navigation {
    position: relative;
    display: flex;
    background: white;
    border-radius: var(--radius-xl);
    padding: 0.5rem;
    margin-bottom: 2rem;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border);
}

.nav-track {
    position: absolute;
    top: 0.5rem;
    bottom: 0.5rem;
    left: 0.5rem;
    right: 0.5rem;
    pointer-events: none;
}

.nav-indicator {
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    width: calc(33.333% - 0.25rem);
    background: var(--primary);
    border-radius: var(--radius-lg);
    transition: var(--transition);
    box-shadow: var(--shadow-sm);
}

.nav-tab {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    border: none;
    background: none;
    border-radius: var(--radius-lg);
    color: var(--text-secondary);
    font-weight: 500;
    cursor: pointer;
    transition: var(--transition);
    position: relative;
    z-index: 1;
}

.nav-tab.active {
    color: white;
}

.nav-tab:hover:not(.active) {
    color: var(--primary);
    background: var(--secondary);
}

.nav-tab i {
    font-size: 0.9rem;
}

/* Contenido de tabs */
.tab-content-container {
    position: relative;
}

.tab-content {
    display: none;
    animation: fadeIn 0.3s ease;
}

.tab-content.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Grid de contenido */
.content-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
}

/* Cards de información */
.info-card {
    background: white;
    border-radius: var(--radius-xl);
    border: 1px solid var(--border);
    box-shadow: var(--shadow-sm);
    overflow: hidden;
    transition: var(--transition);
}

.info-card:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
}

.card-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.5rem;
    border-bottom: 1px solid var(--border-light);
    background: linear-gradient(180deg, #fafafa 0%, #ffffff 100%);
}

.header-icon {
    width: 40px;
    height: 40px;
    border-radius: var(--radius-lg);
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1rem;
    flex-shrink: 0;
}

.header-text {
    flex: 1;
    min-width: 0;
}

.header-text h3 {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.25rem;
}

.header-text p {
    font-size: 0.85rem;
    color: var(--text-muted);
}

.edit-toggle {
    width: 32px;
    height: 32px;
    border-radius: var(--radius-md);
    border: 1px solid var(--border);
    background: white;
    color: var(--text-secondary);
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
}

.edit-toggle:hover {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}

/* Formularios */
.card-form {
    padding: 1.5rem;
}

.form-layout {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.input-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.input-group.full-width {
    grid-column: 1 / -1;
}

.input-group label {
    font-size: 0.85rem;
    font-weight: 500;
    color: var(--text-secondary);
}

.input-group input,
.input-group select {
    padding: 0.75rem;
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    background: white;
    color: var(--text-primary);
    transition: var(--transition);
    font-size: 0.9rem;
}

.input-group input[readonly],
.input-group select[disabled] {
    background: var(--secondary);
    color: var(--text-muted);
    cursor: not-allowed;
}

.input-group input:focus,
.input-group select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

.input-with-icon {
    position: relative;
    display: flex;
    align-items: center;
}

.input-with-icon i {
    position: absolute;
    left: 0.75rem;
    color: var(--text-muted);
    font-size: 0.9rem;
}

.input-with-icon input {
    padding-left: 2.5rem;
    padding-right: 2.5rem;
}

.toggle-password {
    position: absolute;
    right: 0.75rem;
    background: none;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    padding: 0;
    font-size: 0.9rem;
}

.toggle-password:hover {
    color: var(--primary);
}

.pin-input {
    text-align: center;
    font-family: monospace;
    font-size: 1.2rem;
    letter-spacing: 0.5rem;
}

/* Acciones de formulario */
.form-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    padding-top: 1rem;
    border-top: 1px solid var(--border-light);
}

.form-actions.hidden {
    display: none;
}

.btn-save,
.btn-cancel,
.btn-upload {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    border-radius: var(--radius-md);
    font-weight: 500;
    font-size: 0.9rem;
    cursor: pointer;
    transition: var(--transition);
    border: none;
    text-decoration: none;
}

.btn-save {
    background: var(--primary);
    color: white;
}

.btn-save:hover:not(:disabled) {
    background: var(--primary-dark);
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

.btn-save:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.btn-cancel {
    background: var(--secondary);
    color: var(--text-secondary);
}

.btn-cancel:hover {
    background: var(--border);
}

.btn-upload {
    background: linear-gradient(135deg, var(--accent) 0%, #be185d 100%);
    color: white;
}

.btn-upload:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

/* Sección de foto */
.photo-section {
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
}

.photo-preview {
    position: relative;
}

.preview-image,
.preview-placeholder {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    box-shadow: var(--shadow-md);
}

.preview-placeholder {
    background: var(--primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    font-weight: 600;
}

.photo-upload input[type="file"] {
    display: none;
}

/* Indicadores de seguridad */
.security-indicators {
    margin-bottom: 1rem;
}

.indicator {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0;
    font-size: 0.85rem;
    color: var(--text-muted);
}

.indicator.valid {
    color: var(--success);
}

.indicator.valid i {
    color: var(--success);
}

/* Preferencias */
.preferences-content {
    padding: 1.5rem;
}

.preference-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 0;
    border-bottom: 1px solid var(--border-light);
}

.preference-item:last-child {
    border-bottom: none;
}

.preference-info h4 {
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.25rem;
}

.preference-info p {
    font-size: 0.8rem;
    color: var(--text-muted);
}

/* Toggle switch */
.toggle-switch {
    position: relative;
}

.toggle-switch input {
    display: none;
}

.toggle-switch label {
    display: block;
    width: 44px;
    height: 24px;
    background: var(--border);
    border-radius: 12px;
    cursor: pointer;
    transition: var(--transition);
    position: relative;
}

.toggle-switch label::after {
    content: '';
    position: absolute;
    top: 2px;
    left: 2px;
    width: 20px;
    height: 20px;
    background: white;
    border-radius: 50%;
    transition: var(--transition);
    box-shadow: var(--shadow-sm);
}

.toggle-switch input:checked + label {
    background: var(--primary);
}

.toggle-switch input:checked + label::after {
    transform: translateX(20px);
}

/* Responsive */
@media (max-width: 768px) {
    .modern-profile-container {
        padding: 0.5rem;
    }
    
    .hero-content {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
        padding: 1.5rem;
    }
    
    .profile-meta {
        justify-content: center;
    }
    
    .tab-navigation {
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .nav-indicator {
        display: none;
    }
    
    .nav-tab.active {
        background: var(--primary);
        color: white;
    }
    
    .content-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .form-layout {
        grid-template-columns: 1fr;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .card-header {
        padding: 1rem;
    }
    
    .card-form {
        padding: 1rem;
    }
}

@media (max-width: 480px) {
    .profile-name {
        font-size: 1.25rem;
    }
    
    .badge-avatar,
    .badge-avatar-placeholder {
        width: 60px;
        height: 60px;
    }
    
    .badge-avatar-placeholder {
        font-size: 1.2rem;
    }
    
    .preview-image,
    .preview-placeholder {
        width: 80px;
        height: 80px;
    }
    
    .preview-placeholder {
        font-size: 1.5rem;
    }
}
</style>

<script>
// Navegación de tabs
function switchTab(tabName) {
    // Actualizar indicador visual
    const tabs = document.querySelectorAll('.nav-tab');
    const indicator = document.querySelector('.nav-indicator');
    const activeTab = document.querySelector(`.nav-tab[data-tab="${tabName}"]`);
    
    tabs.forEach((tab, index) => {
        tab.classList.remove('active');
        if (tab.dataset.tab === tabName) {
            tab.classList.add('active');
            indicator.style.transform = `translateX(${index * 100}%)`;
        }
    });
    
    // Mostrar contenido
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
    });
    document.getElementById(`tab-${tabName}`).classList.add('active');
    
    // Actualizar URL
    const url = new URL(window.location);
    url.searchParams.set('tab', tabName);
    window.history.pushState({}, '', url);
}

// Alternar edición de formularios
function toggleEdit(formType) {
    const form = document.getElementById(`${formType}-form`);
    const actions = document.getElementById(`${formType}-actions`);
    const inputs = form.querySelectorAll('input, select');
    
    inputs.forEach(input => {
        if (input.hasAttribute('readonly')) {
            input.removeAttribute('readonly');
        } else if (input.hasAttribute('disabled')) {
            input.removeAttribute('disabled');
        } else {
            if (input.type === 'email') return; // No permitir editar email
            input.setAttribute('readonly', '');
        }
    });
    
    actions.classList.toggle('hidden');
}

function cancelEdit(formType) {
    const form = document.getElementById(`${formType}-form`);
    const actions = document.getElementById(`${formType}-actions`);
    
    // Restaurar valores originales
    form.reset();
    
    // Volver a readonly/disabled
    form.querySelectorAll('input, select').forEach(input => {
        if (input.type !== 'hidden') {
            if (input.tagName === 'SELECT') {
                input.setAttribute('disabled', '');
            } else {
                input.setAttribute('readonly', '');
            }
        }
    });
    
    actions.classList.add('hidden');
}

// Toggle de contraseñas
function togglePassword(inputId) {
    const input = document.getElementById(inputId);
    const button = input.nextElementSibling;
    const icon = button.querySelector('i');
    
    if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}

// Validación de contraseñas
document.addEventListener('DOMContentLoaded', function() {
    const newPassInput = document.getElementById('new-pass');
    const confirmPassInput = document.getElementById('confirm-pass');
    const changeBtn = document.getElementById('change-password-btn');
    const lengthIndicator = document.getElementById('length-indicator');
    const matchIndicator = document.getElementById('match-indicator');
    
    function validatePassword() {
        const newPass = newPassInput?.value || '';
        const confirmPass = confirmPassInput?.value || '';
        
        // Validar longitud
        if (newPass.length >= 8) {
            lengthIndicator?.classList.add('valid');
            lengthIndicator?.querySelector('i').classList.remove('fa-times');
            lengthIndicator?.querySelector('i').classList.add('fa-check');
        } else {
            lengthIndicator?.classList.remove('valid');
            lengthIndicator?.querySelector('i').classList.remove('fa-check');
            lengthIndicator?.querySelector('i').classList.add('fa-times');
        }
        
        // Validar coincidencia
        if (newPass && confirmPass && newPass === confirmPass) {
            matchIndicator?.classList.add('valid');
            matchIndicator?.querySelector('i').classList.remove('fa-times');
            matchIndicator?.querySelector('i').classList.add('fa-check');
        } else {
            matchIndicator?.classList.remove('valid');
            matchIndicator?.querySelector('i').classList.remove('fa-check');
            matchIndicator?.querySelector('i').classList.add('fa-times');
        }
        
        // Habilitar/deshabilitar botón
        if (changeBtn) {
            changeBtn.disabled = !(newPass.length >= 8 && newPass === confirmPass);
        }
    }
    
    newPassInput?.addEventListener('input', validatePassword);
    confirmPassInput?.addEventListener('input', validatePassword);
    
    // Inicializar tab activo
    const urlParams = new URLSearchParams(window.location.search);
    const activeTab = urlParams.get('tab') || 'general';
    switchTab(activeTab);
});
</script>
{% endblock %}
