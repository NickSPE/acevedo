{% extends "core/base_template.html" %}
{% block title %}Cursos | FinGest{% endblock %}

{% block content %}
<div class="mb-6">
  <h2 class="text-2xl font-bold mb-1">Cursos de EducaciÃ³n Financiera</h2>
  <p class="text-sm text-gray-500">Aprende lo esencial sobre finanzas personales con cursos externos seleccionados</p>
</div>

<!-- Filtros -->
<div class="mb-6 flex flex-wrap gap-2">
  <button onclick="filterCourses('all')" class="filter-btn active px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors text-sm">
    Todos
  </button>
  <button onclick="filterCourses('basico')" class="filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors text-sm">
    BÃ¡sico
  </button>
  <button onclick="filterCourses('intermedio')" class="filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors text-sm">
    Intermedio
  </button>
  <button onclick="filterCourses('avanzado')" class="filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors text-sm">
    Avanzado
  </button>
  <button onclick="filterCourses('gratis')" class="filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors text-sm">
    Gratis
  </button>
</div>

<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6" id="courses-grid">
  {% for course in courses %}
    <div class="course-card bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow" 
         data-level="{{ course.nivel|lower }}" 
         data-free="{{ course.gratis|yesno:'true,false' }}">
      
      <!-- Imagen o thumbnail -->
      <div class="relative mb-4">
        {% if course.imagen_url %}
          <img src="{{ course.imagen_url }}" alt="{{ course.titulo }}" class="w-full h-32 object-cover rounded-lg">
        {% else %}
          <div class="h-32 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center text-white text-4xl">
            {{ course.plataforma_icon }}
          </div>
        {% endif %}
        
        <!-- BotÃ³n de favorito -->
        <button onclick="toggleFavorito({{ course.id }})" 
                class="absolute top-2 right-2 p-2 bg-white rounded-full shadow hover:shadow-md transition-shadow"
                id="fav-btn-{{ course.id }}">
          {% if course.es_favorito %}
            <span class="text-red-500">â¤ï¸</span>
          {% else %}
            <span class="text-gray-400">ğŸ¤</span>
          {% endif %}
        </button>
      </div>
      
      <!-- Metadatos -->
      <div class="mb-3 flex justify-between items-center">
        <span class="inline-block px-2 py-1 text-xs font-semibold rounded-full 
          {% if course.nivel == 'BÃ¡sico' %}bg-green-100 text-green-800{% elif course.nivel == 'Intermedio' %}bg-yellow-100 text-yellow-800{% else %}bg-red-100 text-red-800{% endif %}">
          {{ course.nivel }}
        </span>
        
        <div class="flex items-center gap-2 text-xs text-gray-500">
          <span>{{ course.plataforma_icon }} {{ course.plataforma }}</span>
          {% if course.gratis %}
            <span class="bg-green-100 text-green-800 px-2 py-1 rounded">GRATIS</span>
          {% endif %}
        </div>
      </div>
      
      <!-- Contenido -->
      <h3 class="text-lg font-semibold mb-2">{{ course.titulo }}</h3>
      <p class="text-sm text-gray-600 mb-3">{{ course.descripcion|truncatewords:15 }}</p>
      
      <!-- InformaciÃ³n adicional -->
      <div class="text-xs text-gray-500 mb-4 space-y-1">
        {% if course.instructor %}
          <div>ğŸ‘¨â€ğŸ« {{ course.instructor }}</div>
        {% endif %}
        <div>â±ï¸ {{ course.duracion }}</div>
      </div>
      
      <!-- AcciÃ³n -->
      <a href="{{ course.url_externa }}" 
         target="_blank" 
         rel="noopener noreferrer"
         class="block w-full bg-blue-600 text-white py-2 rounded text-sm text-center hover:bg-blue-700 transition-colors">
        Ver Curso ğŸ”—
      </a>
    </div>
  {% empty %}
    <div class="col-span-full text-center py-12">
      <div class="text-gray-400 text-6xl mb-4">ğŸ“š</div>
      <h3 class="text-lg font-semibold text-gray-600 mb-2">No hay cursos disponibles</h3>
      <p class="text-gray-500">Los cursos estarÃ¡n disponibles pronto.</p>
    </div>
  {% endfor %}
</div>

<script>
// Filtrar cursos
function filterCourses(filter) {
  const cards = document.querySelectorAll('.course-card');
  const buttons = document.querySelectorAll('.filter-btn');
  
  // Actualizar botones
  buttons.forEach(btn => {
    btn.classList.remove('active', 'bg-blue-600', 'text-white');
    btn.classList.add('bg-gray-200', 'text-gray-700');
  });
  
  event.target.classList.add('active', 'bg-blue-600', 'text-white');
  event.target.classList.remove('bg-gray-200', 'text-gray-700');
  
  // Filtrar cards
  cards.forEach(card => {
    if (filter === 'all') {
      card.style.display = 'block';
    } else if (filter === 'gratis') {
      card.style.display = card.dataset.free === 'true' ? 'block' : 'none';
    } else {
      card.style.display = card.dataset.level === filter ? 'block' : 'none';
    }
  });
}

// Toggle favorito
function toggleFavorito(cursoId) {
  fetch(`/educacion-financiera/favorito/${cursoId}/`, {
    method: 'POST',
    headers: {
      'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
      'Content-Type': 'application/json',
    },
  })
  .then(response => response.json())
  .then(data => {
    const btn = document.getElementById(`fav-btn-${cursoId}`);
    const span = btn.querySelector('span');
    
    if (data.es_favorito) {
      span.textContent = 'â¤ï¸';
      span.className = 'text-red-500';
    } else {
      span.textContent = 'ğŸ¤';
      span.className = 'text-gray-400';
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('Error al actualizar favorito');
  });
}
</script>

<!-- CSRF Token for AJAX -->
{% csrf_token %}
{% endblock %}
